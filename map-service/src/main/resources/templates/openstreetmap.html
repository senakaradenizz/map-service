<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
    <script src="/home/sena/Desktop/OSM/leaflet.ajax.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
    <style>
      html, body {
        height: 100%;
        padding: 0;
        margin: 0;
      }
      #map {
        /* configure the size of the map */
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div>
      <select class="form-control" name="example" id="countries" onchange="onChangeCountry()">
        <option value="0">Country</option>
      </select> <select class="form-control" name="clientname" id="provinces">
        <option value="0">Province</option>
      </select>
      </select> <select class="form-control" name="clientname" id="clientname">
        <option value="0">Subprovince</option>
      </select>
      <button id="w-button-search" type="button" onclick="getAreaOnClick()">Search</button>
    </div>
    <div id="map"></div>

    <p id="demo"></p>
    <script>
    // initialize Leaflet
    //Ankara area setted
    var map = L.map('map').setView([39.925533, 32.866287], 11);

    // add the OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap contributors</a>'
    }).addTo(map);

    // show the scale bar on the lower left corner
    L.control.scale().addTo(map);
    
    var drawnItems = new L.FeatureGroup();
    map.addLayer(drawnItems);


//http get request
const element = document.getElementById("getData");
    const xhr = new XMLHttpRequest();
    xhr.open("GET", "http://192.168.30.90:8080/mapservice/eventdetails/1");
    xhr.send();
    xhr.onreadystatechange = function () {
      if (this.readyState === 4) {
        if ((this.status === 200) && (this.status < 300)) {
          console.log(this.responseText);
        }
      }
    }


    var countries = document.getElementById("countries");
    var provinces = document.getElementById("provinces");

    function loadAllCountries(data) {
        for (var i = 0; i < data.length; i++) {
            var currentCountry = data[i];
                addCountry(currentCountry);
        }
    }

    function loadAllCoordinates(data) {
        
    }

    function addCountry(currentCountry) {
            var option = document.createElement("option");
            option.text = currentCountry.name;
            option.value = currentCountry.id;
            countries.appendChild(option);
    }

    function addProvinces(data) {
            
                var option = document.createElement("option");
                option.text = data.name;
                option.value = data.id;
                provinces.appendChild(option);
                provinces.selectedIndex = 0;
    }
    
    $.ajax({
          url: "http://192.168.30.90:8080/mapservice/countries",
          type: "GET",
          success: function (data) {
            console.log(data);
            loadAllCountries(data);
          },
          error: function (error) {
            console.log(`Error ${error}`);
          }
    })

    $.ajax({
          url: "http://192.168.30.90:8080/mapservice/coordinates",
          type: "GET",
          success: function (data) {
            console.log(data);
            loadAllCoordinates(data);
          },
          error: function (error) {
            console.log(`Error ${error}`);
          }
    })
    
    </script>
  </body>
</html>
