<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
    <script src="/home/sena/Desktop/OSM/leaflet.ajax.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
    <style>
      html, body {
        height: 100%;
        padding: 0;
        margin: 0;
      }
      #map {
        /* configure the size of the map */
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div>
      <select class="form-control" name="example" id="example">
        <option value="0">Country</option>
        <option th:each="dropdown : ${dropdown}" th:value="${dropdown.id}"
          th:text="${dropdown.tagName}"></option>
      </select> <select class="form-control" name="clientname" id="clientname">
        <option value="0">Province</option>
        <option th:each="dropd : ${drpdwn}" th:value="${dropd.id}"
          th:text="${dropd.tagName}"></option>
      </select>
    </select> <select class="form-control" name="clientname" id="clientname">
      <option value="0">Subprovince</option>
      <option th:each="dropd : ${drpdwn}" th:value="${dropd.id}"
        th:text="${dropd.tagName}"></option>
    </select>
      <button id="w-button-search" type="button">Search</button>
    </div>
    <div id="map"></div>
    Polygon: <input type="text" name="coordPolygon" id="coordPolygon"/>
    <input type="button" onclick="drawPolygon()" value="Draw"/><br> 
    Polyline: <input type="text" name="coordPolyline" id="coordPolyline"/>
    <input type="button" onclick="drawPolyline()" value="Draw"/><br> 
    <p id="demo"></p>
    <script>
    // initialize Leaflet
    //Ankara area setted
    var map = L.map('map').setView([39.925533, 32.866287], 11);

    // add the OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap contributors</a>'
    }).addTo(map);

    // show the scale bar on the lower left corner
    L.control.scale().addTo(map);
    
    var drawnItems = new L.FeatureGroup();
    map.addLayer(drawnItems);

    function drawPolygon() {
            //var coords =  [[48,-3],[50,5],[44,11],[48,-3]] ;          
            var coords = document.getElementById("coordPolygon").value;

            var a = JSON.parse(coords);

            var polygon = L.polygon(a, {color: 'red'});
            polygon.addTo(map);

            map.fitBounds(polygon.getBounds());
        }

    function drawPolyline() {
        //var coords =  [[45,-122],[37,-122],[34,-118]] ;          
        var coords = document.getElementById("coordPolyline").value;

        var a = JSON.parse(coords);        

            var polyline = L.polyline(a, {color: 'red'}).addTo(map);

            map.fitBounds(polyline.getBounds());
    }

    function drawMarkup(){
      var markup;

            for (var l in locations) {
              if (locations.hasOwnProperty(l)) {
                  
                var loc = [locations[l].latitude,locations[l].longitude];
                console.log(loc)
                markup = L.marker(loc).addTo(map);
                  
              }
            }

      }


//http get request
const element = document.getElementById("getData");
    const xhr = new XMLHttpRequest();
    xhr.open("GET", "http://localhost:8080/mapservice/eventdetails/1");
    xhr.send();
    xhr.onreadystatechange = function () {
      if (this.readyState === 4) {
        if ((this.status === 200) && (this.status < 300)) {
          console.log(this.responseText);
        }
      }
    }


   $(document).ready(function() { // for client name 

		$('#example').change(function(event) {
			var country = $("select#example").val(); // country = define value of selected option
			$.getJSON('ajaxAction0', {
				ptype : country
			}, function(data) {
				var select = $('#clientname');
				select.find('option').remove();
				$.each(data, function(key, value) {
					$('<option>').val(key).text(value).appendTo(select);
				});
			});
		});
	}); 

    drawMarkup();

    </script>
  </body>
</html>
